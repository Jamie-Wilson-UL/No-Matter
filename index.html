<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No Matter Blaster</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
    <style>
        body { text-align: center; background-color: black; color: white; }
        canvas { border: 1px solid white; display: block; margin: 20px auto; }
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    </style>
</head>
<body onload="brython()">
    <canvas id="game-canvas" width="800" height="600"></canvas>
    <audio id="background-audio" src="theme.mp3" loop></audio>
    <script type="text/python">
        from browser import document, html, window
        from time import time

        WIDTH, HEIGHT = 800, 600
        PLAYER_SIZE = 50
        ENEMY_SIZE = 50
        BULLET_SIZE = 10
        PLAYER_SPEED = 10
        BULLET_SPEED = 5
        ENEMY_BULLET_SPEED = 3
        MAX_LEVELS = 3

        score = 0
        level = 1
        game_over = False
        game_started = False
        showing_level_title = False
        ENEMY_SPEED = 2
        flash_text = True
        player_last_shot = 0
        player_shot_cooldown = 0.5  # Cooldown time in seconds

        player_pos = [WIDTH // 2, HEIGHT - 2 * PLAYER_SIZE]

        spaceship_img = html.IMG(src="spaceship.png")
        title_img = html.IMG(src="title.png")
        face_images = ["face_0.png", "face_1.png", "face_2.png", "face_3.png"]
        faces = [html.IMG(src=img) for img in face_images]

        enemies = []
        bullets = []
        enemy_bullets = []
        stars = [{"x": window.Math.random() * WIDTH, "y": window.Math.random() * HEIGHT, "size": window.Math.random() * 3 + 1} for _ in range(100)]

        canvas = document["game-canvas"]
        ctx = canvas.getContext("2d")
        background_audio = document["background-audio"]

        def initialize_game():
            global enemies, bullets, enemy_bullets, showing_level_title, ENEMY_SPEED, game_over, level, game_started, score
            enemies = [{"pos": [col * (ENEMY_SIZE + 10) + 50, row * (ENEMY_SIZE + 10) + 50], "img": faces[int(window.Math.random() * len(faces))]} for row in range(3) for col in range(8)]
            bullets = []
            enemy_bullets = []
            showing_level_title = False
            ENEMY_SPEED = 2 + level  # Increase enemy speed with level
            game_over = False
            game_started = True
            background_audio.play()

        def reset_game():
            global level, game_started, game_over, score
            level = 1
            game_over = False
            game_started = False
            score = 0
            animate_title_screen()

        def draw_start_screen():
            ctx.clearRect(0, 0, WIDTH, HEIGHT)
            move_stars()
            draw_stars()
            title_width, title_height = 1655 // 2.5, 134 // 2.5
            ctx.drawImage(title_img, (WIDTH - title_width) // 2, (HEIGHT // 3 - title_height // 2), title_width, title_height)
            if flash_text:
                ctx.fillStyle = "white"
                ctx.font = "24px 'Press Start 2P'"
                ctx.textAlign = "center"
                ctx.fillText("Press Space to Play", WIDTH // 2, HEIGHT // 2)

        def draw_level_title():
            ctx.clearRect(0, 0, WIDTH, HEIGHT)
            move_stars()
            draw_stars()
            ctx.fillStyle = "white"
            ctx.font = "48px 'Press Start 2P'"
            ctx.fillText(f"Level {level}", WIDTH // 2, HEIGHT // 2)

        def draw_final_score():
            ctx.clearRect(0, 0, WIDTH, HEIGHT)
            move_stars()
            draw_stars()
            ctx.fillStyle = "white"
            ctx.font = "48px 'Press Start 2P'"
            ctx.textAlign = "center"
            ctx.fillText(f"Final Score: {score}", WIDTH // 2, HEIGHT // 2)

        def draw_stars():
            ctx.fillStyle = "white"
            for star in stars:
                ctx.fillRect(star["x"], star["y"], star["size"], star["size"])

        def move_stars():
            for star in stars:
                star["y"] += 1
                if star["y"] > HEIGHT:
                    star["y"] = 0
                    star["x"] = window.Math.random() * WIDTH

        def draw():
            global game_over, game_started, showing_level_title
            ctx.clearRect(0, 0, WIDTH, HEIGHT)
            move_stars()
            draw_stars()
            if not game_started:
                draw_start_screen()
            elif showing_level_title:
                draw_level_title()
            else:
                if not game_over:
                    ctx.drawImage(spaceship_img, player_pos[0], player_pos[1], PLAYER_SIZE, PLAYER_SIZE)
                for enemy in enemies:
                    ctx.drawImage(enemy["img"], enemy["pos"][0], enemy["pos"][1], ENEMY_SIZE, ENEMY_SIZE)
                ctx.fillStyle = "yellow"
                for bullet in bullets:
                    ctx.fillRect(bullet[0], bullet[1], BULLET_SIZE, BULLET_SIZE)
                ctx.fillStyle = "red"
                for bullet in enemy_bullets:
                    ctx.fillRect(bullet[0], bullet[1], BULLET_SIZE, BULLET_SIZE)
                ctx.fillStyle = "white"
                ctx.font = "24px 'Press Start 2P'"
                ctx.textAlign = "right"
                ctx.fillText(f"Score: {score}", WIDTH - 20, 40)
                if game_over:
                    ctx.fillStyle = "red"
                    ctx.font = "48px 'Press Start 2P'"
                    ctx.fillText("GAME OVER", WIDTH // 2, HEIGHT // 2)
                    window.setTimeout(show_final_score, 3000)
                if len(enemies) == 0 and not game_over:
                    if level < MAX_LEVELS:
                        level_up()
                    else:
                        ctx.fillStyle = "green"
                        ctx.font = "48px 'Press Start 2P'"
                        ctx.fillText("YOU WIN!", WIDTH // 2, HEIGHT // 2)
                        game_over = True
                        window.setTimeout(show_final_score, 3000)

        def show_final_score():
            draw_final_score()
            window.setTimeout(reset_game, 3000)

        def update():
            global game_over, score, game_started, showing_level_title, ENEMY_SPEED

            if game_over or not game_started or showing_level_title:
                return

            for bullet in bullets[:]:
                bullet[1] -= BULLET_SPEED
                if bullet[1] < 0:
                    bullets.remove(bullet)

            for bullet in enemy_bullets[:]:
                bullet[1] += ENEMY_BULLET_SPEED
                if bullet[1] > HEIGHT:
                    enemy_bullets.remove(bullet)

            for enemy in enemies[:]:
                for bullet in bullets[:]:
                    if bullet[0] >= enemy["pos"][0] and bullet[0] <= enemy["pos"][0] + ENEMY_SIZE and bullet[1] >= enemy["pos"][1] and bullet[1] <= enemy["pos"][1] + ENEMY_SIZE:
                        enemies.remove(enemy)
                        bullets.remove(bullet)
                        score += 1
                        break

            for bullet in enemy_bullets[:]:
                if bullet[0] >= player_pos[0] and bullet[0] <= player_pos[0] + PLAYER_SIZE and bullet[1] >= player_pos[1] and bullet[1] <= player_pos[1] + PLAYER_SIZE:
                    game_over = True

            for enemy in enemies:
                if (enemy["pos"][0] <= player_pos[0] <= enemy["pos"][0] + ENEMY_SIZE or
                    enemy["pos"][0] <= player_pos[0] + PLAYER_SIZE <= enemy["pos"][0] + ENEMY_SIZE) and \
                    (enemy["pos"][1] <= player_pos[1] <= enemy["pos"][1] + ENEMY_SIZE or
                    enemy["pos"][1] <= player_pos[1] + PLAYER_SIZE <= enemy["pos"][1] + ENEMY_SIZE):
                    game_over = True

            move_down = False
            for enemy in enemies:
                enemy["pos"][0] += ENEMY_SPEED
                if enemy["pos"][0] > WIDTH - ENEMY_SIZE or enemy["pos"][0] < 0:
                    move_down = True
            if move_down:
                for enemy in enemies:
                    enemy["pos"][1] += ENEMY_SIZE
                ENEMY_SPEED = -ENEMY_SPEED

            draw()

        def enemy_shoot():
            global game_over, game_started, showing_level_title
            if game_over or not game_started or showing_level_title:
                return
            for enemy in enemies:
                if window.Math.random() < (0.05 + 0.01 * level):  # Adjust the probability as needed
                    enemy_bullets.append([enemy["pos"][0] + ENEMY_SIZE // 2, enemy["pos"][1] + ENEMY_SIZE])

        def level_up():
            global level, showing_level_title
            level += 1
            showing_level_title = True
            draw_level_title()
            window.setTimeout(initialize_game, 1000)

        def start_game():
            global showing_level_title, game_started
            showing_level_title = False
            game_started = True
            initialize_game()

        def move_player(event):
            global game_started, game_over, player_last_shot
            current_time = time()
            if event.keyCode == 32 and not game_started:  # Space key to start
                if background_audio.paused:
                    background_audio.play()
                start_game()
            elif game_started and not showing_level_title and not game_over:
                if event.keyCode == 37 and player_pos[0] > 0:  # Left arrow
                    player_pos[0] -= PLAYER_SPEED
                elif event.keyCode == 39 and player_pos[0] < WIDTH - PLAYER_SIZE:  # Right arrow
                    player_pos[0] += PLAYER_SPEED
                elif event.keyCode == 32 and current_time - player_last_shot > player_shot_cooldown:  # Space key to shoot
                    bullets.append([player_pos[0] + PLAYER_SIZE // 2 - BULLET_SIZE // 2, player_pos[1]])
                    player_last_shot = current_time

        def toggle_flash_text():
            global flash_text
            flash_text = not flash_text

        document.bind("keydown", move_player)
        window.setInterval(update, 30)
        window.setInterval(enemy_shoot, 1000)  # Enemy attempts to shoot every second
        window.setInterval(toggle_flash_text, 1000)  # Toggle the flash text every second

        # Continuously draw the start screen to move stars
        def animate_title_screen():
            if not game_started:
                draw_start_screen()
                window.requestAnimationFrame(lambda x: animate_title_screen())

        animate_title_screen()  # Start the animation loop for the title screen
    </script>
</body>
</html>





